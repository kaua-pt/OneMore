<!DOCTYPE html>
<html>
<head>
  <title>SignalR SessionHub Test</title>
  <script src="https://unpkg.com/@microsoft/signalr@8.0.0/dist/browser/signalr.min.js"></script>
</head>
<body>

  <button onclick="connect()">ğŸ”Œ Conectar</button>
  <button onclick="createSession()">â• CreateSession</button>
  <button onclick="joinSession()">ğŸ‘¤ JoinSession</button>
  <button onclick="leaveSession()">ğŸšª LeaveSession</button>
  <button onclick="startGame()">ğŸ® StartGame</button>

  <pre id="log"></pre>

  <script>
    let connection;
    let session; // AQUI vamos guardar a sessÃ£o

    function log(message) {
      const el = document.getElementById("log");
      el.textContent += message + "\n";
    }

    async function connect() {
      connection = new signalR.HubConnectionBuilder()
        .withUrl("https://localhost:7054/game")
        .withAutomaticReconnect()
        .build();

      // ğŸ”¥ EVENTOS (RETORNOS DO BACKEND)
      connection.on("SessionCreated", data => {
        session = data;
        console.log("ğŸ“¦ SessionCreated:", data);
        log("SessionCreated â†’ " + JSON.stringify(data, null, 2));
      });

      connection.on("Word", data => {
        console.log("ğŸ“ Word recebida:", data);
        log("Word â†’ " + JSON.stringify(data));
      });
      
      connection.on("PlayerJoined", data => {
        console.log("ğŸ‘¤ PlayerJoined:", data);
        log("PlayerJoined â†’ " + JSON.stringify(data));
      });

      connection.on("PlayerLeft", data => {
        console.log("ğŸšª PlayerLeft:", data);
        log("PlayerLeft â†’ " + JSON.stringify(data));
      });

      connection.on("GameStarted", data => {
        console.log("ğŸ® GameStarted:", data);
        log("GameStarted â†’ " + JSON.stringify(data));
      });

      try {
        await connection.start();
        console.log("âœ… Conectado ao SessionHub");
        log("Conectado");
      } catch (e) {
        console.error("âŒ Erro ao conectar", e);
      }
    }

    async function createSession() {
      await invoke("CreateSession", {
        sessionName: "Minha SessÃ£o",
        userName: "Jogador1"
      });
    }

    async function joinSession() {
      if (!session) {
        alert("Crie ou receba a sessÃ£o primeiro");
        return;
      }

      await invoke("JoinSession", {
        sessionId: session.id,
        userName: "Jogador2"
      });
    }

    async function leaveSession() {
      if (!session) return;

      await invoke("LeaveSession", {
        sessionId: session.id,
        userName: "Jogador2"
      });
    }

    async function startGame() {
      if (!session) return;

      await invoke("StartGame", {
        userId: session.masterId,
        sessionId: session.id
      });
    }

    async function invoke(method, payload) {
      if (!connection || connection.state !== "Connected") {
        console.warn("âš ï¸ NÃ£o conectado");
        return;
      }

      try {
        await connection.invoke(method, payload);
        console.log(`â¡ï¸ ${method}`, payload);
        log(`${method} enviado`);
      } catch (e) {
        console.error(`âŒ Erro em ${method}`, e);
      }
    }
  </script>

</body>
</html>
